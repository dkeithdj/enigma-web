---
import Layout from "@/layouts/Layout.astro";
import { getPost, getPosts } from "@/utils/sanity/client";
import type { InferGetStaticParamsType } from "astro";
import { PortableText } from "../../components/portabletext";
import { formatDate } from "@/utils/sanity";

export async function getStaticPaths() {
  const posts = await getPosts();
  return posts.map((post) => ({
    params: { slug: post.slug.current },
  }));
}

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
const { slug } = Astro.params as Params;

const post = await getPost(slug);
---

<Layout title={post.title!}>
  <div class="relative w-full h-[150px] md:h-[250px]">
    <div
      class="absolute inset-0 bg-center bg-cover"
      style={{
        backgroundImage: `url(${post.mainImage}`,
      }}
    >
    </div>
    <div class="absolute inset-0 bg-gradient-to-t from-white to-transparent">
    </div>
    <div class="absolute inset-0 bg-white bg-opacity-50"></div>
    <div class="relative flex justify-center items-end h-full">
      <div class="text-center">
        <h1 class="text-3xl md:text-5xl font-bold pb-4">
          {post.title}
        </h1>
        <p class="pb-4">{formatDate(post._createdAt)}</p>
      </div>
    </div>
  </div>
  <section class="mt-4 mx-4 md:mx-auto">
    <div class="prose prose-rose prose-sm md:prose-md break-words mx-auto">
      <PortableText value={post.body} />
    </div>
  </section>
</Layout>
